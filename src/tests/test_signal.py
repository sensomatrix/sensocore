import unittest
import os
import json
from ..app import create_app, db

class UsersTest(unittest.TestCase):
  """
  Users Test Case
  """
  def setUp(self):
    """
    Test Setup
    """
    self.app = create_app("testing")
    self.client = self.app.test_client()
    self.user = {
      'name': 'olawale',
      'email': 'olawale@mail.com',
      'password': 'passw0rd!'
    }

    with self.app.app_context():
      # create all tables
      db.create_all()

  def test_create_signal(self):
    """ Test Create Signal """
    res = self.client.post('/api/v1/users/', headers={'Content-Type': 'application/json'}, data=json.dumps(self.user))
    self.assertEqual(res.status_code, 201)
    api_token = json.loads(res.data).get('jwt_token')
    res = self.client.post('/api/v1/signals/', headers={'Content-Type': 'application/json', 'api-token': api_token}, data=json.dumps({
      'data': "{\"raw\":{\"channel1\":{\"data\":[-1.230791507903753e-25,-4.695383431308576e-25,-1.762026341957203e-24,-6.504416909924155e-24,-2.3618866266942547e-23,-8.436541108468322e-23,-2.9643161288476934e-22,-1.0245644657653807e-21,-3.483443351981197e-21,-1.1650187038400869e-20,-3.832761078427487e-20,-1.2403529341262608e-19,-3.94851253282161e-19,-1.236449623911988e-18,-3.808675789113142e-18,-1.1540540183389736e-17,-3.4397955048437933e-17,-1.0085390354129929e-16,-2.908737875348665e-16,-8.25207502241958e-16,-2.302796921722981e-15,-6.320484889995757e-15,-1.705972128428386e-14,-4.5263353612087776e-14,-1.1794757607663103e-13,-3.012783436357608e-13,-7.51341805611816e-13,-1.81413814092507e-12,-4.1666596388434396e-12,-8.741148430080337e-12,-1.490472502363449e-11,-9.956621464801696e-12,7.774877963662163e-11,5.632076471862035e-10,2.6700159860837402e-09,1.0765528912770606e-08,3.940115789191623e-08,1.3415650812476088e-07,4.2968889601979754e-07,1.301741463066719e-06,3.740982037925278e-06,1.0214898793492466e-05,7.535290241241455,7.188230991363525,6.835055828094482,6.614430904388428,6.373291969299316,6.105592727661133,5.799904823303223,5.965451240539551,6.417153835296631,6.779487609863281,7.583508014678955,8.472874641418457,9.288532257080078,9.477500915527344,9.467317581176758,9.595138549804688,9.650596618652344,9.285533905029297,8.275409698486328,7.155129432678223,6.6423563957214355,6.351118564605713,5.974894046783447,5.786584854125977,5.850672721862793,6.120707035064697,6.287959575653076,6.702082633972168,7.570745944976807,8.35509204864502,9.007062911987305,9.534310340881348,9.991706848144531,10.039210319519043,9.90000057220459,9.202298164367676,8.375677108764648,7.745635986328125,7.156764030456543,6.430728435516357,6.217670917510986,6.4057745933532715,6.8126912117004395,7.155708312988281,7.134826183319092,7.41185998916626,7.745553016662598,8.133495330810547,8.534587860107422,8.946126937866211,8.899510383605957,8.243943214416504,7.304520130157471,6.462313652038574,6.159847736358643,6.11648416519165,6.005188465118408,6.066151142120361,6.183969497680664,6.488771438598633,7.163619041442871,7.77018404006958,8.488686561584473,8.901518821716309,5.225722789764404,5.4055705070495605,6.204926490783691,7.163449764251709,7.740124702453613,8.273553848266602,8.715734481811523,9.42126178741455,9.968395233154297,10.109414100646973,9.733240127563477,9.121275901794434,8.176877975463867,7.461363792419434,7.0404133796691895,6.7369160652160645,6.624630928039551,6.281618595123291,6.014691352844238,6.047523498535156,6.48394775390625,7.033011436462402,7.814444541931152,8.716218948364258,9.495865821838379,9.810835838317871,9.599709510803223,9.512292861938477,9.20485782623291,8.359004974365234,7.477875232696533,6.7830705642700195,6.0631103515625,5.2629313468933105,4.950363636016846,5.30705451965332,5.8200178146362305,6.322447299957275,6.656270980834961,7.08897066116333,7.620405197143555,8.293797492980957,8.766563415527344,9.285449981689453,9.567846298217773,9.324050903320312,8.835192680358887,8.485387802124023,8.050984382629395,7.4997992515563965,7.088036060333252,6.442549705505371,5.997623920440674,6.133667945861816,6.50123929977417]}},\"header\":{\"patient_information\":{\"birthdate\":\"_Nan_\",\"height\":\"_NaN_\",\"full_name\":\"\",\"age\":-1,\"sex\":\"_Nan_\",\"address\":\"_Nan_\",\"weight\":\"_NaN_\",\"id\":\"\"},\"filtered\":{\"channel1\":{\"data\":{}},\"channel3\":{\"data\":{}},\"channel2\":{\"data\":{}}},\"recording_info\":{\"instituition\":\"_Nan_\",\"date\":\"18-JUL-2017\",\"visit_num\":-1,\"admin_id\":\"_Nan_\",\"saved_location_on_disk_or_network\":\"\",\"admin_name\":\"_Nan_\",\"address\":\"_Nan_\",\"time_description\":\"EasternTime(US&Canada)\"},\"device_information\":{\"channel2\":{\"data\":{\"unit\":\"mV\",\"start_time\":\"0.0\",\"dimension\":1,\"description\":\"\",\"fs\":200,\"end_time\":\"10.0\"},\"name\":\"EEGSimualtion\",\"sensor_location\":\"\",\"sensor\":\"EEG\"},\"company\":\"SensoMatrix\",\"channel_num\":3,\"SIN\":\"\",\"name\":\"SensoMatrix\",\"channel1\":{\"data\":{\"unit\":\"mV\",\"start_time\":\"0.0\",\"dimension\":1,\"description\":\"\",\"fs\":256,\"end_time\":\"9.878906\"},\"name\":\"ECGSimulation\",\"sensor_location\":\"\",\"sensor\":\"ECG\"},\"channel3\":{\"data\":{\"unit\":\"mV\",\"start_time\":\"1.55078125\",\"dimension\":1,\"description\":\"\",\"fs\":256,\"end_time\":\"6.19921875\"},\"name\":\"ECGSimulation\",\"sensor_location\":\"\",\"sensor\":\"ECG\"},\"type\":\"\"},\"epoch_information\":{\"channel1\":{\"epoch2\":{\"name\":\"Video\",\"duration\":\"00:08:00\",\"start_time\":\"11:43:00\",\"end_time\":\"11:51:00\"},\"epoch_num\":0,\"epoch3\":{\"name\":\"Video\",\"duration\":\"00:08:00\",\"start_time\":\"11:43:00\",\"end_time\":\"11:51:00\"},\"epoch1\":{\"name\":\"Video\",\"duration\":\"00:08:00\",\"start_time\":\"11:43:00\",\"end_time\":\"11:51:00\"}},\"channel3\":{\"epoch2\":{\"name\":\"Video\",\"duration\":\"00:08:00\",\"start_time\":\"11:43:00\",\"end_time\":\"11:51:00\"},\"epoch_num\":0,\"epoch3\":{\"name\":\"Video\",\"duration\":\"00:08:00\",\"start_time\":\"11:43:00\",\"end_time\":\"11:51:00\"},\"epoch1\":{\"name\":\"Video\",\"duration\":\"00:08:00\",\"start_time\":\"11:43:00\",\"end_time\":\"11:51:00\"}},\"channel2\":{\"epoch2\":{\"name\":\"Video\",\"duration\":\"00:08:00\",\"start_time\":\"11:43:00\",\"end_time\":\"11:51:00\"},\"epoch_num\":0,\"epoch3\":{\"name\":\"Video\",\"duration\":\"00:08:00\",\"start_time\":\"11:43:00\",\"end_time\":\"11:51:00\"},\"epoch1\":{\"name\":\"Video\",\"duration\":\"00:08:00\",\"start_time\":\"11:43:00\",\"end_time\":\"11:51:00\"}}}}}"
    }))
    self.assertEqual(res.status_code, 201)

  def test_get_all_signals(self):
    """ Test Create Signal """
    res = self.client.post('/api/v1/users/', headers={'Content-Type': 'application/json'}, data=json.dumps(self.user))
    self.assertEqual(res.status_code, 201)
    api_token = json.loads(res.data).get('jwt_token')
    res = self.client.post('/api/v1/signals/', headers={'Content-Type': 'application/json', 'api-token': api_token}, data=json.dumps({
      'data': "{\"raw\":{\"channel1\":{\"data\":[-1.230791507903753e-25,-4.695383431308576e-25,-1.762026341957203e-24,-6.504416909924155e-24,-2.3618866266942547e-23,-8.436541108468322e-23,-2.9643161288476934e-22,-1.0245644657653807e-21,-3.483443351981197e-21,-1.1650187038400869e-20,-3.832761078427487e-20,-1.2403529341262608e-19,-3.94851253282161e-19,-1.236449623911988e-18,-3.808675789113142e-18,-1.1540540183389736e-17,-3.4397955048437933e-17,-1.0085390354129929e-16,-2.908737875348665e-16,-8.25207502241958e-16,-2.302796921722981e-15,-6.320484889995757e-15,-1.705972128428386e-14,-4.5263353612087776e-14,-1.1794757607663103e-13,-3.012783436357608e-13,-7.51341805611816e-13,-1.81413814092507e-12,-4.1666596388434396e-12,-8.741148430080337e-12,-1.490472502363449e-11,-9.956621464801696e-12,7.774877963662163e-11,5.632076471862035e-10,2.6700159860837402e-09,1.0765528912770606e-08,3.940115789191623e-08,1.3415650812476088e-07,4.2968889601979754e-07,1.301741463066719e-06,3.740982037925278e-06,1.0214898793492466e-05,7.535290241241455,7.188230991363525,6.835055828094482,6.614430904388428,6.373291969299316,6.105592727661133,5.799904823303223,5.965451240539551,6.417153835296631,6.779487609863281,7.583508014678955,8.472874641418457,9.288532257080078,9.477500915527344,9.467317581176758,9.595138549804688,9.650596618652344,9.285533905029297,8.275409698486328,7.155129432678223,6.6423563957214355,6.351118564605713,5.974894046783447,5.786584854125977,5.850672721862793,6.120707035064697,6.287959575653076,6.702082633972168,7.570745944976807,8.35509204864502,9.007062911987305,9.534310340881348,9.991706848144531,10.039210319519043,9.90000057220459,9.202298164367676,8.375677108764648,7.745635986328125,7.156764030456543,6.430728435516357,6.217670917510986,6.4057745933532715,6.8126912117004395,7.155708312988281,7.134826183319092,7.41185998916626,7.745553016662598,8.133495330810547,8.534587860107422,8.946126937866211,8.899510383605957,8.243943214416504,7.304520130157471,6.462313652038574,6.159847736358643,6.11648416519165,6.005188465118408,6.066151142120361,6.183969497680664,6.488771438598633,7.163619041442871,7.77018404006958,8.488686561584473,8.901518821716309,5.225722789764404,5.4055705070495605,6.204926490783691,7.163449764251709,7.740124702453613,8.273553848266602,8.715734481811523,9.42126178741455,9.968395233154297,10.109414100646973,9.733240127563477,9.121275901794434,8.176877975463867,7.461363792419434,7.0404133796691895,6.7369160652160645,6.624630928039551,6.281618595123291,6.014691352844238,6.047523498535156,6.48394775390625,7.033011436462402,7.814444541931152,8.716218948364258,9.495865821838379,9.810835838317871,9.599709510803223,9.512292861938477,9.20485782623291,8.359004974365234,7.477875232696533,6.7830705642700195,6.0631103515625,5.2629313468933105,4.950363636016846,5.30705451965332,5.8200178146362305,6.322447299957275,6.656270980834961,7.08897066116333,7.620405197143555,8.293797492980957,8.766563415527344,9.285449981689453,9.567846298217773,9.324050903320312,8.835192680358887,8.485387802124023,8.050984382629395,7.4997992515563965,7.088036060333252,6.442549705505371,5.997623920440674,6.133667945861816,6.50123929977417]}},\"header\":{\"patient_information\":{\"birthdate\":\"_Nan_\",\"height\":\"_NaN_\",\"full_name\":\"\",\"age\":-1,\"sex\":\"_Nan_\",\"address\":\"_Nan_\",\"weight\":\"_NaN_\",\"id\":\"\"},\"filtered\":{\"channel1\":{\"data\":{}},\"channel3\":{\"data\":{}},\"channel2\":{\"data\":{}}},\"recording_info\":{\"instituition\":\"_Nan_\",\"date\":\"18-JUL-2017\",\"visit_num\":-1,\"admin_id\":\"_Nan_\",\"saved_location_on_disk_or_network\":\"\",\"admin_name\":\"_Nan_\",\"address\":\"_Nan_\",\"time_description\":\"EasternTime(US&Canada)\"},\"device_information\":{\"channel2\":{\"data\":{\"unit\":\"mV\",\"start_time\":\"0.0\",\"dimension\":1,\"description\":\"\",\"fs\":200,\"end_time\":\"10.0\"},\"name\":\"EEGSimualtion\",\"sensor_location\":\"\",\"sensor\":\"EEG\"},\"company\":\"SensoMatrix\",\"channel_num\":3,\"SIN\":\"\",\"name\":\"SensoMatrix\",\"channel1\":{\"data\":{\"unit\":\"mV\",\"start_time\":\"0.0\",\"dimension\":1,\"description\":\"\",\"fs\":256,\"end_time\":\"9.878906\"},\"name\":\"ECGSimulation\",\"sensor_location\":\"\",\"sensor\":\"ECG\"},\"channel3\":{\"data\":{\"unit\":\"mV\",\"start_time\":\"1.55078125\",\"dimension\":1,\"description\":\"\",\"fs\":256,\"end_time\":\"6.19921875\"},\"name\":\"ECGSimulation\",\"sensor_location\":\"\",\"sensor\":\"ECG\"},\"type\":\"\"},\"epoch_information\":{\"channel1\":{\"epoch2\":{\"name\":\"Video\",\"duration\":\"00:08:00\",\"start_time\":\"11:43:00\",\"end_time\":\"11:51:00\"},\"epoch_num\":0,\"epoch3\":{\"name\":\"Video\",\"duration\":\"00:08:00\",\"start_time\":\"11:43:00\",\"end_time\":\"11:51:00\"},\"epoch1\":{\"name\":\"Video\",\"duration\":\"00:08:00\",\"start_time\":\"11:43:00\",\"end_time\":\"11:51:00\"}},\"channel3\":{\"epoch2\":{\"name\":\"Video\",\"duration\":\"00:08:00\",\"start_time\":\"11:43:00\",\"end_time\":\"11:51:00\"},\"epoch_num\":0,\"epoch3\":{\"name\":\"Video\",\"duration\":\"00:08:00\",\"start_time\":\"11:43:00\",\"end_time\":\"11:51:00\"},\"epoch1\":{\"name\":\"Video\",\"duration\":\"00:08:00\",\"start_time\":\"11:43:00\",\"end_time\":\"11:51:00\"}},\"channel2\":{\"epoch2\":{\"name\":\"Video\",\"duration\":\"00:08:00\",\"start_time\":\"11:43:00\",\"end_time\":\"11:51:00\"},\"epoch_num\":0,\"epoch3\":{\"name\":\"Video\",\"duration\":\"00:08:00\",\"start_time\":\"11:43:00\",\"end_time\":\"11:51:00\"},\"epoch1\":{\"name\":\"Video\",\"duration\":\"00:08:00\",\"start_time\":\"11:43:00\",\"end_time\":\"11:51:00\"}}}}}"
    }))
    res = self.client.get('/api/v1/signals/', headers={'Content-Type': 'application/json', 'api-token': api_token})
    self.assertEqual(res.status_code, 200)

  def test_get_one_signal(self):
    """ Test Create Signal """
    res = self.client.post('/api/v1/users/', headers={'Content-Type': 'application/json'}, data=json.dumps(self.user))
    self.assertEqual(res.status_code, 201)
    api_token = json.loads(res.data).get('jwt_token')
    res = self.client.get('/api/v1/signals/1', headers={'Content-Type': 'application/json', 'api-token': api_token})
    self.assertEqual(res.status_code, 200)

  def tearDown(self):
    """
    Tear Down
    """
    with self.app.app_context():
      db.session.remove()
      db.drop_all()

if __name__ == "__main__":
  unittest.main()
